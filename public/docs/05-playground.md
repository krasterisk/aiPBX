# Песочница (Playground) — тестирование ассистентов

> Песочница — это безопасная среда, где вы можете **позвонить ассистенту прямо из браузера**, услышать его голос, проверить логику диалога и настроить параметры — всё без публикации в продакшн.

---

## Содержание

1. [Зачем нужна Песочница?](#зачем-нужна-песочница)
2. [Интерфейс Песочницы](#интерфейс-песочницы)
3. [Как провести тест](#как-провести-тест)
4. [Настройки для тестирования](#настройки-для-тестирования)
5. [Чтение логов и отладка](#чтение-логов-и-отладка)
6. [Сценарии использования](#сценарии-использования)
7. [Советы по тестированию](#советы-по-тестированию)

---

## Зачем нужна Песочница?

Перед публикацией ассистента (SIP, виджет) **обязательно протестируйте** его в Песочнице. Вот почему:

| Без тестирования | С тестированием |
|---|---|
| Промпт может работать не так, как задумано | Вы проверите каждый сценарий |
| Функции могут вызываться не в тот момент | Убедитесь, что ИИ собирает все данные перед вызовом |
| Голос может не подходить | Послушаете и замените |
| Клиенты столкнутся с ошибками | Вы найдёте и исправите их |

---

## Интерфейс Песочницы

<div class="form-mockup form-mockup-wide">
  <div class="form-mockup-title">Playground</div>
  <div class="form-mockup-row" style="align-items: flex-start;">
    <div style="flex: 2;">
      <div class="form-mockup-section-title">Настройки</div>
      <div class="form-mockup-field">
        <label>Ассистент</label>
        <div class="form-mockup-select">Бот поддержки ▾</div>
      </div>
      <div class="form-mockup-field">
        <label>Модель</label>
        <div class="form-mockup-select">gpt-realtime ▾</div>
      </div>
      <div class="form-mockup-field">
        <label>Голос</label>
        <div class="form-mockup-select">alloy ▾</div>
      </div>
      <div class="form-mockup-field">
        <label>Температура: 0.8</label>
        <div class="form-mockup-slider">
          <div class="slider-track">
            <div class="slider-fill" style="width: 40%;"></div>
            <div class="slider-thumb" style="left: 40%;"></div>
          </div>
        </div>
      </div>
      <div class="form-mockup-field">
        <label>Порог VAD: 0.5</label>
        <div class="form-mockup-slider">
          <div class="slider-track">
            <div class="slider-fill" style="width: 50%;"></div>
            <div class="slider-thumb" style="left: 50%;"></div>
          </div>
        </div>
      </div>
      <div class="form-mockup-field">
        <label>Время простоя: 30</label>
        <div class="form-mockup-slider">
          <div class="slider-track">
            <div class="slider-fill" style="width: 22%;"></div>
            <div class="slider-thumb" style="left: 22%;"></div>
          </div>
        </div>
      </div>
      <div class="form-mockup-field">
        <label>Инструкция (промпт)</label>
        <div class="form-mockup-textarea" style="min-height: 80px;">Ты — оператор сервисного центра «ТехноМастер»...</div>
      </div>
      <div class="form-mockup-actions" style="border: none;">
        <div class="form-mockup-btn form-mockup-btn-secondary">Сбросить</div>
      </div>
    </div>
    <div style="flex: 3;">
      <div class="form-mockup-section-title">Диалог</div>
      <div class="form-mockup-card">
        <div class="card-desc">
          <strong>Ассистент:</strong> Здравствуйте! Сервисный центр «ТехноМастер». Чем могу помочь?<br><br>
          <strong>Вы:</strong> Стиральная машина сломалась, не отжимает<br><br>
          <strong>Ассистент:</strong> Понял! Подскажите, какая марка и модель вашей стиральной машины?<br><br>
          <strong>Вы:</strong> Samsung WW65...<br><br>
          <strong>Ассистент:</strong> Samsung WW65, проблема с отжимом. Когда удобно принять мастера?
        </div>
      </div>
      <div class="form-mockup-section-title">Логи</div>
      <div class="form-mockup-card">
        <div class="card-meta" style="font-family: monospace; font-size: 12px;">
          [14:32:01] Session started<br>
          [14:32:02] STT: "Стиральная машина сломалась..."<br>
          [14:32:03] LLM response<br>
          [14:32:15] STT: "Samsung..."<br>
          [14:32:16] Function call: check_schedule(...)
        </div>
      </div>
      <div class="form-mockup-actions" style="justify-content: center; border: none;">
        <div class="form-mockup-btn form-mockup-btn-primary">Начать разговор</div>
      </div>
    </div>
  </div>
</div>

---

## Как провести тест

### Шаг 1. Выберите ассистента

В выпадающем списке **«Ассистент»** выберите того, кого хотите протестировать. Все его настройки (промпт, функции, параметры) загрузятся автоматически.

### Шаг 2. Настройте параметры (опционально)

Вы можете менять настройки **прямо в Песочнице**, не редактируя ассистента:
- Сменить модель, чтобы сравнить качество
- Изменить голос
- Подкрутить температуру
- Отредактировать промпт «на лету»

> Совет: Изменения в Песочнице **не сохраняются** в карточку ассистента. Это безопасная среда для экспериментов.

### Шаг 3. Начните разговор

Нажмите **«Начать разговор»**. Браузер запросит доступ к микрофону — разрешите.

<div class="form-mockup">
  <div class="form-mockup-title">Доступ к микрофону</div>
  <div class="form-mockup-card">
    <div class="card-desc" style="text-align: center;">
      aipbx.com хочет получить доступ к вашему микрофону
    </div>
  </div>
  <div class="form-mockup-actions" style="justify-content: center;">
    <div class="form-mockup-btn form-mockup-btn-secondary">Запретить</div>
    <div class="form-mockup-btn form-mockup-btn-primary">Разрешить</div>
  </div>
</div>

После подключения:
1. Ассистент произнесёт **приветствие** (если оно указано в промпте)
2. Говорите в микрофон как обычный клиент
3. Ассистент ответит голосом
4. В области логов вы увидите весь процесс: распознавание речи, ответы ИИ, вызовы функций

### Шаг 4. Проверьте ключевые моменты

- Правильно ли ассистент представляется?
- Понимает ли он вопросы?
- Вызывает ли функции в нужный момент?
- Все ли данные собирает перед вызовом функции?
- Корректно ли завершает диалог?
- Соблюдает ли ограничения из промпта?

### Шаг 5. Сбросить и повторить

Нажмите **«Сбросить»**, чтобы начать новый разговор с чистого листа. Это эквивалент нового входящего звонка.

---

## Настройки для тестирования

| Настройка | Описание | Что менять для теста |
|-----------|----------|---------------------|
| **Ассистент** | Выбор ассистента из списка | Сравните разных ассистентов |
| **Модель** | Языковая модель | Попробуйте gpt-realtime vs qwen-realtime для одного промпта |
| **Голос** | Голосовая персона | Послушайте, какой голос лучше подходит |
| **Температура** | Креативность ответов | Увеличьте до 1.0 чтобы увидеть вариативность |
| **Порог VAD** | Чувствительность к речи | Если ассистент «перебивает» — увеличьте |
| **Время простоя** | Тайм-аут тишины | Уменьшите для быстрых тестов |
| **Инструкция** | Текст промпта | Редактируйте и сразу проверяйте |

---

## Чтение логов и отладка

В нижней части диалога отображаются **лог-записи** — технический журнал сессии:

```text
[14:32:01] Session started
[14:32:01] TTS: "Здравствуйте! Сервисный центр ТехноМастер."
[14:32:05] STT: "Стиральная машина сломалась не отжимает"
[14:32:06] LLM: Processing...
[14:32:07] TTS: "Понял! Подскажите марку и модель..."
[14:32:15] STT: "Samsung WW65"
[14:32:16] LLM: Processing...
[14:32:16] Function call: check_schedule({"date": "2026-03-21"})
[14:32:17] Function result: {"slots": ["10:00", "14:30"]}
[14:32:18] TTS: "Есть свободные слоты в 10:00 и 14:30..."
```

### Что означают записи:

| Тип | Описание |
|-----|----------|
| **Session** | Начало/конец сессии |
| **STT** | Распознавание речи (что услышал ассистент) |
| **LLM** | Обработка языковой моделью |
| **TTS** | Синтез речи (что сказал ассистент) |
| **Function** | Вызов функции (с параметрами) |
| **Result** | Результат вызова функции |
| **Error** | Ошибка (функция не доступна, таймаут и т.д.) |

---

## Сценарии использования

### 1. Отладка промпта

**Цель:** убедиться, что ассистент правильно понимает роль

- Тест 1: Обычный клиент → Ассистент приветствует и ведёт диалог ✅
- Тест 2: Вопрос не по теме → Ассистент отвечает «Это не в моей компетенции» ✅
- Тест 3: Агрессивный клиент → Ассистент остаётся вежливым ✅
- Тест 4: Клиент даёт неполные данные → Ассистент дополнительно спрашивает ✅

### 2. Проверка функций

**Цель:** убедиться, что функции вызываются правильно

- Тест 1: Клиент называет все данные → Функция вызвана с полными параметрами ✅
- Тест 2: Клиент называет только имя → Ассистент дозапрашивает недостающее ✅
- Тест 3: Webhook недоступен → Ассистент сообщает об ошибке ⚠️

### 3. Выбор голоса

**Цель:** найти голос, подходящий для клиники

- shimmer — мягкий, заботливый → подходит ✅
- echo — глубокий, спокойный → подходит ✅
- ash — энергичный → не подходит для клиники ❌

### 4. Сравнение моделей

**Цель:** выбрать модель с лучшим балансом цена/качество

Тест: одинаковый промпт, один вопрос «Хочу записаться на завтра к стоматологу»

**gpt-realtime:** Уточнил время, спросил о причине, проверил расписание. Задержка ~0.8 сек ✅

**qwen-realtime:** Уточнил время, записал. Не спросил о причине обращения. Задержка ~0.5 сек ⚠️

---

## Советы по тестированию

1. **Говорите как реальный клиент.** Не проговаривайте идеально — мямлите, делайте паузы, перебивайте. Так вы проверите устойчивость ассистента

2. **Тестируйте пограничные случаи:**
   - Что если клиент молчит?
   - Что если говорит на другом языке?
   - Что если задаёт вопрос, на который нет ответа?

3. **Проверяйте функции на ошибки:**
   - Отключите webhook и посмотрите, как ассистент обрабатывает ошибку
   - Дайте неполные данные и убедитесь, что ассистент не вызывает функцию раньше времени

4. **Записывайте результаты.** После каждого теста отмечайте, что работает, а что нужно исправить. Итеративная отладка промпта — нормальный процесс

5. **Тестируйте после каждого изменения.** Поменяли промпт → протестировали. Добавили функцию → протестировали. Не накапливайте изменения

---

*Предыдущий раздел: [MCP Серверы](./04-mcp-servers.md) · Следующий раздел: [Dashboards и аналитика →](./06-dashboards.md)*
